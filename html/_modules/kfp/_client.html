

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>kfp._client &mdash; Kubeflow Pipelines  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Kubeflow Pipelines
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../source/kfp.html">kfp package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Kubeflow Pipelines</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>kfp._client</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for kfp._client</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2018 Google LLC</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#      http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">tarfile</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">Callable</span>

<span class="kn">import</span> <span class="nn">kfp</span>
<span class="kn">import</span> <span class="nn">kfp_server_api</span>

<span class="kn">from</span> <span class="nn">kfp.compiler</span> <span class="kn">import</span> <span class="n">compiler</span>
<span class="kn">from</span> <span class="nn">kfp.compiler._k8s_helper</span> <span class="kn">import</span> <span class="n">sanitize_k8s_name</span>

<span class="kn">from</span> <span class="nn">kfp._auth</span> <span class="kn">import</span> <span class="n">get_auth_token</span><span class="p">,</span> <span class="n">get_gcp_access_token</span>



<span class="k">def</span> <span class="nf">_add_generated_apis</span><span class="p">(</span><span class="n">target_struct</span><span class="p">,</span> <span class="n">api_module</span><span class="p">,</span> <span class="n">api_client</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;Initializes a hierarchical API object based on the generated API module.</span>
<span class="sd">  PipelineServiceApi.create_pipeline becomes target_struct.pipelines.create_pipeline</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">Struct</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;Struct&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{})</span>

  <span class="k">def</span> <span class="nf">camel_case_to_snake_case</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
      <span class="kn">import</span> <span class="nn">re</span>
      <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;([a-z0-9])([A-Z])&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\1_\2&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

  <span class="k">for</span> <span class="n">api_name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">api_module</span><span class="p">):</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">api_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;ServiceApi&#39;</span><span class="p">):</span>
          <span class="k">continue</span>

      <span class="n">short_api_name</span> <span class="o">=</span> <span class="n">camel_case_to_snake_case</span><span class="p">(</span><span class="n">api_name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="s1">&#39;ServiceApi&#39;</span><span class="p">)])</span> <span class="o">+</span> <span class="s1">&#39;s&#39;</span>
      <span class="n">api_struct</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">()</span>
      <span class="nb">setattr</span><span class="p">(</span><span class="n">target_struct</span><span class="p">,</span> <span class="n">short_api_name</span><span class="p">,</span> <span class="n">api_struct</span><span class="p">)</span>
      <span class="n">service_api</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">api_module</span><span class="o">.</span><span class="n">api</span><span class="p">,</span> <span class="n">api_name</span><span class="p">)</span>
      <span class="n">initialized_service_api</span> <span class="o">=</span> <span class="n">service_api</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">member_name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">initialized_service_api</span><span class="p">):</span>
          <span class="k">if</span> <span class="n">member_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">member_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_with_http_info&#39;</span><span class="p">):</span>
              <span class="k">continue</span>

          <span class="n">bound_member</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">initialized_service_api</span><span class="p">,</span> <span class="n">member_name</span><span class="p">)</span>
          <span class="nb">setattr</span><span class="p">(</span><span class="n">api_struct</span><span class="p">,</span> <span class="n">member_name</span><span class="p">,</span> <span class="n">bound_member</span><span class="p">)</span>
  <span class="n">models_struct</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">member_name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">api_module</span><span class="o">.</span><span class="n">models</span><span class="p">):</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">member_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">islower</span><span class="p">():</span>
          <span class="nb">setattr</span><span class="p">(</span><span class="n">models_struct</span><span class="p">,</span> <span class="n">member_name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">api_module</span><span class="o">.</span><span class="n">models</span><span class="p">,</span> <span class="n">member_name</span><span class="p">))</span>
  <span class="n">target_struct</span><span class="o">.</span><span class="n">api_models</span> <span class="o">=</span> <span class="n">models_struct</span>


<span class="n">KF_PIPELINES_ENDPOINT_ENV</span> <span class="o">=</span> <span class="s1">&#39;KF_PIPELINES_ENDPOINT&#39;</span>
<span class="n">KF_PIPELINES_UI_ENDPOINT_ENV</span> <span class="o">=</span> <span class="s1">&#39;KF_PIPELINES_UI_ENDPOINT&#39;</span>
<span class="n">KF_PIPELINES_DEFAULT_EXPERIMENT_NAME</span> <span class="o">=</span> <span class="s1">&#39;KF_PIPELINES_DEFAULT_EXPERIMENT_NAME&#39;</span>
<span class="n">KF_PIPELINES_OVERRIDE_EXPERIMENT_NAME</span> <span class="o">=</span> <span class="s1">&#39;KF_PIPELINES_OVERRIDE_EXPERIMENT_NAME&#39;</span>


<div class="viewcode-block" id="Client"><a class="viewcode-back" href="../../source/kfp.client.html#kfp.Client">[docs]</a><span class="k">class</span> <span class="nc">Client</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; API Client for KubeFlow Pipeline.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># in-cluster DNS name of the pipeline service</span>
  <span class="n">IN_CLUSTER_DNS_NAME</span> <span class="o">=</span> <span class="s1">&#39;ml-pipeline.</span><span class="si">{}</span><span class="s1">.svc.cluster.local:8888&#39;</span>
  <span class="n">KUBE_PROXY_PATH</span> <span class="o">=</span> <span class="s1">&#39;api/v1/namespaces/</span><span class="si">{}</span><span class="s1">/services/ml-pipeline:http/proxy/&#39;</span>

  <span class="n">LOCAL_KFP_CONTEXT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~/.config/kfp/context.json&#39;</span><span class="p">)</span>

  <span class="c1"># TODO: Wrap the configurations for different authentication methods.</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">client_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s1">&#39;kubeflow&#39;</span><span class="p">,</span> <span class="n">other_client_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">other_client_secret</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">existing_token</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a new instance of kfp client.</span>

<span class="sd">    Args:</span>
<span class="sd">      host: the host name to use to talk to Kubeflow Pipelines. If not set, the in-cluster</span>
<span class="sd">          service DNS name will be used, which only works if the current environment is a pod</span>
<span class="sd">          in the same cluster (such as a Jupyter instance spawned by Kubeflow&#39;s</span>
<span class="sd">          JupyterHub). If you have a different connection to cluster, such as a kubectl</span>
<span class="sd">          proxy connection, then set it to something like &quot;127.0.0.1:8080/pipeline.</span>
<span class="sd">          If you connect to an IAP enabled cluster, set it to</span>
<span class="sd">          https://&lt;your-deployment&gt;.endpoints.&lt;your-project&gt;.cloud.goog/pipeline&quot;.</span>
<span class="sd">      client_id: The client ID used by Identity-Aware Proxy.</span>
<span class="sd">      namespace: the namespace where the kubeflow pipeline system is run.</span>
<span class="sd">      other_client_id: The client ID used to obtain the auth codes and refresh tokens.</span>
<span class="sd">          Reference: https://cloud.google.com/iap/docs/authentication-howto#authenticating_from_a_desktop_app.</span>
<span class="sd">      other_client_secret: The client secret used to obtain the auth codes and refresh tokens.</span>
<span class="sd">      existing_token: pass in token directly, it&#39;s used for cases better get token outside of SDK, e.x. GCP Cloud Functions</span>
<span class="sd">          or caller already has a token</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_uihost</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">KF_PIPELINES_UI_ENDPOINT_ENV</span><span class="p">,</span> <span class="n">host</span><span class="p">)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_config</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">client_id</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">other_client_id</span><span class="p">,</span> <span class="n">other_client_secret</span><span class="p">,</span> <span class="n">existing_token</span><span class="p">)</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">kfp_server_api</span><span class="o">.</span><span class="n">api_client</span><span class="o">.</span><span class="n">ApiClient</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">_add_generated_apis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kfp_server_api</span><span class="p">,</span> <span class="n">api_client</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_job_api</span> <span class="o">=</span> <span class="n">kfp_server_api</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">job_service_api</span><span class="o">.</span><span class="n">JobServiceApi</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_run_api</span> <span class="o">=</span> <span class="n">kfp_server_api</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">run_service_api</span><span class="o">.</span><span class="n">RunServiceApi</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_api</span> <span class="o">=</span> <span class="n">kfp_server_api</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">experiment_service_api</span><span class="o">.</span><span class="n">ExperimentServiceApi</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_pipelines_api</span> <span class="o">=</span> <span class="n">kfp_server_api</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">pipeline_service_api</span><span class="o">.</span><span class="n">PipelineServiceApi</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_upload_api</span> <span class="o">=</span> <span class="n">kfp_server_api</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">PipelineUploadServiceApi</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_load_context_setting_or_default</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">_load_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">client_id</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">other_client_id</span><span class="p">,</span> <span class="n">other_client_secret</span><span class="p">,</span> <span class="n">existing_token</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">kfp_server_api</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">Configuration</span><span class="p">()</span>

    <span class="n">host</span> <span class="o">=</span> <span class="n">host</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
    <span class="c1"># Preprocess the host endpoint to prevent some common user mistakes.</span>
    <span class="c1"># This should only be done for non-IAP cases (when client_id is None). IAP requires preserving the protocol.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">client_id</span><span class="p">:</span>
      <span class="n">host</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(http|https)://&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">host</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">host</span><span class="p">:</span>
      <span class="n">config</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>

    <span class="n">token</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># &quot;existing_token&quot; is designed to accept token generated outside of SDK. Here is an example.</span>
    <span class="c1">#</span>
    <span class="c1"># https://cloud.google.com/functions/docs/securing/function-identity</span>
    <span class="c1"># https://cloud.google.com/endpoints/docs/grpc/service-account-authentication</span>
    <span class="c1">#</span>
    <span class="c1"># import requests</span>
    <span class="c1"># import kfp</span>
    <span class="c1">#</span>
    <span class="c1"># def get_access_token():</span>
    <span class="c1">#     url = &#39;http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token&#39;</span>
    <span class="c1">#     r = requests.get(url, headers={&#39;Metadata-Flavor&#39;: &#39;Google&#39;})</span>
    <span class="c1">#     r.raise_for_status()</span>
    <span class="c1">#     access_token = r.json()[&#39;access_token&#39;]</span>
    <span class="c1">#     return access_token</span>
    <span class="c1">#</span>
    <span class="c1"># client = kfp.Client(host=&#39;&lt;KFPHost&gt;&#39;, existing_token=get_access_token())</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="n">existing_token</span><span class="p">:</span>
      <span class="n">token</span> <span class="o">=</span> <span class="n">existing_token</span>
    <span class="k">elif</span> <span class="n">client_id</span><span class="p">:</span>
      <span class="n">token</span> <span class="o">=</span> <span class="n">get_auth_token</span><span class="p">(</span><span class="n">client_id</span><span class="p">,</span> <span class="n">other_client_id</span><span class="p">,</span> <span class="n">other_client_secret</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_inverse_proxy_host</span><span class="p">(</span><span class="n">host</span><span class="p">):</span>
      <span class="n">token</span> <span class="o">=</span> <span class="n">get_gcp_access_token</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">token</span><span class="p">:</span>
      <span class="n">config</span><span class="o">.</span><span class="n">api_key</span><span class="p">[</span><span class="s1">&#39;authorization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span>
      <span class="n">config</span><span class="o">.</span><span class="n">api_key_prefix</span><span class="p">[</span><span class="s1">&#39;authorization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Bearer&#39;</span>
      <span class="k">return</span> <span class="n">config</span>

    <span class="k">if</span> <span class="n">host</span><span class="p">:</span>
      <span class="c1"># if host is explicitly set with auth token, it&#39;s probably a port forward address.</span>
      <span class="k">return</span> <span class="n">config</span>

    <span class="kn">import</span> <span class="nn">kubernetes</span> <span class="k">as</span> <span class="nn">k8s</span>
    <span class="n">in_cluster</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">k8s</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">load_incluster_config</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="n">in_cluster</span> <span class="o">=</span> <span class="kc">False</span>
      <span class="k">pass</span>

    <span class="k">if</span> <span class="n">in_cluster</span><span class="p">:</span>
      <span class="n">config</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">Client</span><span class="o">.</span><span class="n">IN_CLUSTER_DNS_NAME</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">config</span>

    <span class="k">try</span><span class="p">:</span>
      <span class="n">k8s</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">load_kube_config</span><span class="p">(</span><span class="n">client_configuration</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed to load kube config.&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">config</span>

    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">host</span><span class="p">:</span>
      <span class="n">config</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">host</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">Client</span><span class="o">.</span><span class="n">KUBE_PROXY_PATH</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config</span>

  <span class="k">def</span> <span class="nf">_is_inverse_proxy_host</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">host</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\S+.googleusercontent.com/{0,1}$&#39;</span><span class="p">,</span> <span class="n">host</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\w+&#39;</span><span class="p">,</span> <span class="n">host</span><span class="p">):</span>
      <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
          <span class="s1">&#39;The received host is </span><span class="si">%s</span><span class="s1">, please include the full endpoint address &#39;</span>
          <span class="s1">&#39;(with &quot;.(pipelines/notebooks).googleusercontent.com&quot;)&#39;</span> <span class="o">%</span> <span class="n">host</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">False</span>

  <span class="k">def</span> <span class="nf">_is_ipython</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns whether we are running in notebook.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="kn">import</span> <span class="nn">IPython</span>
      <span class="n">ipy</span> <span class="o">=</span> <span class="n">IPython</span><span class="o">.</span><span class="n">get_ipython</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">ipy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
      <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span>

  <span class="k">def</span> <span class="nf">_get_url_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uihost</span><span class="p">:</span>
      <span class="c1"># User&#39;s own connection.</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uihost</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;http://&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uihost</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;https://&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uihost</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;http://&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uihost</span>

    <span class="c1"># In-cluster pod. We could use relative URL.</span>
    <span class="k">return</span> <span class="s1">&#39;/pipeline&#39;</span>

  <span class="k">def</span> <span class="nf">_load_context_setting_or_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">Client</span><span class="o">.</span><span class="n">LOCAL_KFP_CONTEXT</span><span class="p">):</span>
      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Client</span><span class="o">.</span><span class="n">LOCAL_KFP_CONTEXT</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context_setting</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_context_setting</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;namespace&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
      <span class="p">}</span>

<div class="viewcode-block" id="Client.set_user_namespace"><a class="viewcode-back" href="../../source/kfp.client.html#kfp.Client.set_user_namespace">[docs]</a>  <span class="k">def</span> <span class="nf">set_user_namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set user namespace into local context setting file.</span>
<span class="sd">       This function should only be used when Kubeflow Pipelines is in the multi-user mode.</span>

<span class="sd">    Args:</span>
<span class="sd">       namespace: kubernetes namespace the user has access to.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context_setting</span><span class="p">[</span><span class="s1">&#39;namespace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">namespace</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Client</span><span class="o">.</span><span class="n">LOCAL_KFP_CONTEXT</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
      <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_context_setting</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.get_user_namespace"><a class="viewcode-back" href="../../source/kfp.client.html#kfp.Client.get_user_namespace">[docs]</a>  <span class="k">def</span> <span class="nf">get_user_namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get user namespace in context config.</span>
<span class="sd">    Returns:</span>
<span class="sd">      namespace: kubernetes namespace from the local context file or empty if it wasn&#39;t set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context_setting</span><span class="p">[</span><span class="s1">&#39;namespace&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Client.create_experiment"><a class="viewcode-back" href="../../source/kfp.client.html#kfp.Client.create_experiment">[docs]</a>  <span class="k">def</span> <span class="nf">create_experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a new experiment.</span>

<span class="sd">    Args:</span>
<span class="sd">      name: the name of the experiment.</span>
<span class="sd">      description: description of the experiment.</span>
<span class="sd">      namespace: kubernetes namespace where the experiment should be created.</span>

<span class="sd">        For single user deployment, leave it as None;</span>

<span class="sd">        For multi user, input a namespace where the user is authorized.</span>

<span class="sd">    Returns:</span>
<span class="sd">      An Experiment object. Most important field is id.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">namespace</span> <span class="o">=</span> <span class="n">namespace</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_namespace</span><span class="p">()</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">experiment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_experiment</span><span class="p">(</span><span class="n">experiment_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="c1"># Ignore error if the experiment does not exist.</span>
      <span class="k">pass</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">experiment</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating experiment </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

      <span class="n">resource_references</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">if</span> <span class="n">namespace</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ApiResourceKey</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ApiResourceType</span><span class="o">.</span><span class="n">NAMESPACE</span><span class="p">)</span>
        <span class="n">reference</span> <span class="o">=</span> <span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ApiResourceReference</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">relationship</span><span class="o">=</span><span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ApiRelationship</span><span class="o">.</span><span class="n">OWNER</span><span class="p">)</span>
        <span class="n">resource_references</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span>

      <span class="n">experiment</span> <span class="o">=</span> <span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ApiExperiment</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
        <span class="n">resource_references</span><span class="o">=</span><span class="n">resource_references</span><span class="p">)</span>
      <span class="n">experiment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_api</span><span class="o">.</span><span class="n">create_experiment</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">experiment</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_ipython</span><span class="p">():</span>
      <span class="kn">import</span> <span class="nn">IPython</span>
      <span class="n">html</span> <span class="o">=</span> \
          <span class="p">(</span><span class="s1">&#39;Experiment link &lt;a href=&quot;</span><span class="si">%s</span><span class="s1">/#/experiments/details/</span><span class="si">%s</span><span class="s1">&quot; target=&quot;_blank&quot; &gt;here&lt;/a&gt;&#39;</span>
          <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_url_prefix</span><span class="p">(),</span> <span class="n">experiment</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
      <span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">experiment</span></div>

<div class="viewcode-block" id="Client.list_experiments"><a class="viewcode-back" href="../../source/kfp.client.html#kfp.Client.list_experiments">[docs]</a>  <span class="k">def</span> <span class="nf">list_experiments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page_token</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;List experiments.</span>
<span class="sd">    Args:</span>
<span class="sd">      page_token: token for starting of the page.</span>
<span class="sd">      page_size: size of the page.</span>
<span class="sd">      sort_by: can be &#39;[field_name]&#39;, &#39;[field_name] des&#39;. For example, &#39;name des&#39;.</span>
<span class="sd">      namespace: kubernetes namespace where the experiment was created.</span>
<span class="sd">        For single user deployment, leave it as None;</span>
<span class="sd">        For multi user, input a namespace where the user is authorized.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A response object including a list of experiments and next page token.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">namespace</span> <span class="o">=</span> <span class="n">namespace</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_namespace</span><span class="p">()</span>
    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_api</span><span class="o">.</span><span class="n">list_experiment</span><span class="p">(</span>
      <span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">,</span>
      <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span>
      <span class="n">sort_by</span><span class="o">=</span><span class="n">sort_by</span><span class="p">,</span>
      <span class="n">resource_reference_key_type</span><span class="o">=</span><span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">api_resource_type</span><span class="o">.</span><span class="n">ApiResourceType</span><span class="o">.</span><span class="n">NAMESPACE</span><span class="p">,</span>
      <span class="n">resource_reference_key_id</span><span class="o">=</span><span class="n">namespace</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span></div>

<div class="viewcode-block" id="Client.get_experiment"><a class="viewcode-back" href="../../source/kfp.client.html#kfp.Client.get_experiment">[docs]</a>  <span class="k">def</span> <span class="nf">get_experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">experiment_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get details of an experiment</span>
<span class="sd">    Either experiment_id or experiment_name is required</span>
<span class="sd">    Args:</span>
<span class="sd">      experiment_id: id of the experiment. (Optional)</span>
<span class="sd">      experiment_name: name of the experiment. (Optional)</span>
<span class="sd">      namespace: kubernetes namespace where the experiment was created.</span>
<span class="sd">        For single user deployment, leave it as None;</span>
<span class="sd">        For multi user, input the namespace where the user is authorized.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A response object including details of a experiment.</span>
<span class="sd">    Throws:</span>
<span class="sd">      Exception if experiment is not found or None of the arguments is provided</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">namespace</span> <span class="o">=</span> <span class="n">namespace</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_namespace</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">experiment_id</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">experiment_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Either experiment_id or experiment_name is required&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">experiment_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_api</span><span class="o">.</span><span class="n">get_experiment</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">experiment_id</span><span class="p">)</span>
    <span class="n">next_page_token</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">while</span> <span class="n">next_page_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">list_experiments_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_experiments</span><span class="p">(</span><span class="n">page_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">page_token</span><span class="o">=</span><span class="n">next_page_token</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">)</span>
      <span class="n">next_page_token</span> <span class="o">=</span> <span class="n">list_experiments_response</span><span class="o">.</span><span class="n">next_page_token</span>
      <span class="k">for</span> <span class="n">experiment</span> <span class="ow">in</span> <span class="n">list_experiments_response</span><span class="o">.</span><span class="n">experiments</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">experiment</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">experiment_name</span><span class="p">:</span>
          <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_api</span><span class="o">.</span><span class="n">get_experiment</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">experiment</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No experiment is found with name </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">))</span></div>

  <span class="k">def</span> <span class="nf">_extract_pipeline_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package_file</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_choose_pipeline_yaml_file</span><span class="p">(</span><span class="n">file_list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
      <span class="n">yaml_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">file_list</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.yaml&#39;</span><span class="p">)]</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">yaml_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid package. Missing pipeline yaml file in the package.&#39;</span><span class="p">)</span>

      <span class="k">if</span> <span class="s1">&#39;pipeline.yaml&#39;</span> <span class="ow">in</span> <span class="n">yaml_files</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;pipeline.yaml&#39;</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">yaml_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
          <span class="k">return</span> <span class="n">yaml_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid package. There is no pipeline.yaml file and there are multiple yaml files.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">package_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.tar.gz&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">package_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.tgz&#39;</span><span class="p">):</span>
      <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">package_file</span><span class="p">,</span> <span class="s2">&quot;r:gz&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
        <span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">member</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">tar</span> <span class="k">if</span> <span class="n">member</span><span class="o">.</span><span class="n">isfile</span><span class="p">()]</span>
        <span class="n">pipeline_yaml_file</span> <span class="o">=</span> <span class="n">_choose_pipeline_yaml_file</span><span class="p">(</span><span class="n">file_names</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">tar</span><span class="o">.</span><span class="n">extractfile</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">getmember</span><span class="p">(</span><span class="n">pipeline_yaml_file</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
          <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">package_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.zip&#39;</span><span class="p">):</span>
      <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">package_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">zip</span><span class="p">:</span>
        <span class="n">pipeline_yaml_file</span> <span class="o">=</span> <span class="n">_choose_pipeline_yaml_file</span><span class="p">(</span><span class="nb">zip</span><span class="o">.</span><span class="n">namelist</span><span class="p">())</span>
        <span class="k">with</span> <span class="nb">zip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">pipeline_yaml_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
          <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">package_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.yaml&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">package_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.yml&#39;</span><span class="p">):</span>
      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">package_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The package_file &#39;</span><span class="o">+</span> <span class="n">package_file</span> <span class="o">+</span> <span class="s1">&#39; should ends with one of the following formats: [.tar.gz, .tgz, .zip, .yaml, .yml]&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Client.list_pipelines"><a class="viewcode-back" href="../../source/kfp.client.html#kfp.Client.list_pipelines">[docs]</a>  <span class="k">def</span> <span class="nf">list_pipelines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page_token</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;List pipelines.</span>
<span class="sd">    Args:</span>
<span class="sd">      page_token: token for starting of the page.</span>
<span class="sd">      page_size: size of the page.</span>
<span class="sd">      sort_by: one of &#39;field_name&#39;, &#39;field_name des&#39;. For example, &#39;name des&#39;.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A response object including a list of pipelines and next page token.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipelines_api</span><span class="o">.</span><span class="n">list_pipelines</span><span class="p">(</span><span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="n">sort_by</span><span class="p">)</span></div>

  <span class="c1"># TODO: provide default namespace, similar to kubectl default namespaces.</span>
<div class="viewcode-block" id="Client.run_pipeline"><a class="viewcode-back" href="../../source/kfp.client.html#kfp.Client.run_pipeline">[docs]</a>  <span class="k">def</span> <span class="nf">run_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment_id</span><span class="p">,</span> <span class="n">job_name</span><span class="p">,</span> <span class="n">pipeline_package_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{},</span> <span class="n">pipeline_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">version_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run a specified pipeline.</span>

<span class="sd">    Args:</span>
<span class="sd">      experiment_id: The string id of an experiment.</span>
<span class="sd">      job_name: name of the job.</span>
<span class="sd">      pipeline_package_path: local path of the pipeline package(the filename should end with one of the following .tar.gz, .tgz, .zip, .yaml, .yml).</span>
<span class="sd">      params: a dictionary with key (string) as param name and value (string) as as param value.</span>
<span class="sd">      pipeline_id: the string ID of a pipeline.</span>
<span class="sd">      version_id: the string ID of a pipeline version.</span>
<span class="sd">        If both pipeline_id and version_id are specified, version_id will take precendence.</span>
<span class="sd">        If only pipeline_id is specified, the default version of this pipeline is used to create the run.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A run object. Most important field is id.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">job_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_job_config</span><span class="p">(</span>
      <span class="n">experiment_id</span><span class="o">=</span><span class="n">experiment_id</span><span class="p">,</span>
      <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
      <span class="n">pipeline_package_path</span><span class="o">=</span><span class="n">pipeline_package_path</span><span class="p">,</span>
      <span class="n">pipeline_id</span><span class="o">=</span><span class="n">pipeline_id</span><span class="p">,</span>
      <span class="n">version_id</span><span class="o">=</span><span class="n">version_id</span><span class="p">)</span>
    <span class="n">run_body</span> <span class="o">=</span> <span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ApiRun</span><span class="p">(</span>
        <span class="n">pipeline_spec</span><span class="o">=</span><span class="n">job_config</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">resource_references</span><span class="o">=</span><span class="n">job_config</span><span class="o">.</span><span class="n">resource_references</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">job_name</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_api</span><span class="o">.</span><span class="n">create_run</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">run_body</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_ipython</span><span class="p">():</span>
      <span class="kn">import</span> <span class="nn">IPython</span>
      <span class="n">html</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Run link &lt;a href=&quot;</span><span class="si">%s</span><span class="s1">/#/runs/details/</span><span class="si">%s</span><span class="s1">&quot; target=&quot;_blank&quot; &gt;here&lt;/a&gt;&#39;</span>
              <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_url_prefix</span><span class="p">(),</span> <span class="n">response</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
      <span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">run</span></div>

<div class="viewcode-block" id="Client.create_recurring_run"><a class="viewcode-back" href="../../source/kfp.client.html#kfp.Client.create_recurring_run">[docs]</a>  <span class="k">def</span> <span class="nf">create_recurring_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment_id</span><span class="p">,</span> <span class="n">job_name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interval_second</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cron_expression</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_concurrency</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">no_catchup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{},</span> <span class="n">pipeline_package_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pipeline_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">version_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a recurring run.</span>

<span class="sd">    Args:</span>
<span class="sd">      experiment_id: The string id of an experiment.</span>
<span class="sd">      job_name: name of the job.</span>
<span class="sd">      description: An optional job description.</span>
<span class="sd">      start_time: The RFC3339 time string of the time when to start the job.</span>
<span class="sd">      end_time: The RFC3339 time string of the time when to end the job.</span>
<span class="sd">      interval_second: Integer indicating the seconds between two recurring runs in for a periodic schedule.</span>
<span class="sd">      cron_expression: A cron expression representing a set of times, using 5 space-separated fields, e.g. &quot;0 0 9 ? * 2-6&quot;.</span>
<span class="sd">      max_concurrency: Integer indicating how many jobs can be run in parallel.</span>
<span class="sd">      no_catchup: Whether the recurring run should catch up if behind schedule.</span>
<span class="sd">        For example, if the recurring run is paused for a while and re-enabled</span>
<span class="sd">        afterwards. If no_catchup=False, the scheduler will catch up on (backfill) each</span>
<span class="sd">        missed interval. Otherwise, it only schedules the latest interval if more than one interval</span>
<span class="sd">        is ready to be scheduled.</span>
<span class="sd">        Usually, if your pipeline handles backfill internally, you should turn catchup</span>
<span class="sd">        off to avoid duplicate backfill. (default: {False})</span>
<span class="sd">      pipeline_package_path: Local path of the pipeline package(the filename should end with one of the following .tar.gz, .tgz, .zip, .yaml, .yml).</span>
<span class="sd">      params: A dictionary with key (string) as param name and value (string) as param value.</span>
<span class="sd">      pipeline_id: The string ID of a pipeline.</span>
<span class="sd">      version_id: The string ID of a pipeline version. </span>
<span class="sd">        If both pipeline_id and version_id are specified, pipeline_id will take precendence</span>
<span class="sd">        This will change in a future version, so it is recommended to use version_id by itself.</span>
<span class="sd">      enabled: A bool indicating whether the recurring run is enabled or disabled.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A Job object. Most important field is id.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">job_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_job_config</span><span class="p">(</span>
      <span class="n">experiment_id</span><span class="o">=</span><span class="n">experiment_id</span><span class="p">,</span>
      <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
      <span class="n">pipeline_package_path</span><span class="o">=</span><span class="n">pipeline_package_path</span><span class="p">,</span>
      <span class="n">pipeline_id</span><span class="o">=</span><span class="n">pipeline_id</span><span class="p">,</span>
      <span class="n">version_id</span><span class="o">=</span><span class="n">version_id</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">interval_second</span><span class="p">,</span> <span class="n">cron_expression</span><span class="p">])</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">([</span><span class="n">interval_second</span><span class="p">,</span> <span class="n">cron_expression</span><span class="p">]):</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Either interval_second or cron_expression is required&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">interval_second</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">trigger</span> <span class="o">=</span> <span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ApiTrigger</span><span class="p">(</span>
        <span class="n">periodic_schedule</span><span class="o">=</span><span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ApiPeriodicSchedule</span><span class="p">(</span>
          <span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="n">end_time</span><span class="p">,</span> <span class="n">interval_second</span><span class="o">=</span><span class="n">interval_second</span><span class="p">)</span>
      <span class="p">)</span>
    <span class="k">if</span> <span class="n">cron_expression</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">trigger</span> <span class="o">=</span> <span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ApiTrigger</span><span class="p">(</span>
        <span class="n">cron_schedule</span><span class="o">=</span><span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ApiCronSchedule</span><span class="p">(</span>
        <span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="n">end_time</span><span class="p">,</span> <span class="n">cron</span><span class="o">=</span><span class="n">cron_expression</span><span class="p">)</span>
      <span class="p">)</span>

    <span class="n">job_body</span> <span class="o">=</span> <span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ApiJob</span><span class="p">(</span>
        <span class="n">enabled</span><span class="o">=</span><span class="n">enabled</span><span class="p">,</span>
        <span class="n">pipeline_spec</span><span class="o">=</span><span class="n">job_config</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span>
        <span class="n">resource_references</span><span class="o">=</span><span class="n">job_config</span><span class="o">.</span><span class="n">resource_references</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="n">job_name</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
        <span class="n">no_catchup</span><span class="o">=</span><span class="n">no_catchup</span><span class="p">,</span>
        <span class="n">trigger</span><span class="o">=</span><span class="n">trigger</span><span class="p">,</span>
        <span class="n">max_concurrency</span><span class="o">=</span><span class="n">max_concurrency</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_api</span><span class="o">.</span><span class="n">create_job</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">job_body</span><span class="p">)</span></div>

  <span class="k">def</span> <span class="nf">_create_job_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment_id</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">pipeline_package_path</span><span class="p">,</span> <span class="n">pipeline_id</span><span class="p">,</span> <span class="n">version_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a JobConfig with spec and resource_references.</span>

<span class="sd">    Args:</span>
<span class="sd">      experiment_id: The string id of an experiment.</span>
<span class="sd">      pipeline_package_path: Local path of the pipeline package(the filename should end with one of the following .tar.gz, .tgz, .zip, .yaml, .yml).</span>
<span class="sd">      params: A dictionary with key (string) as param name and value (string) as param value.</span>
<span class="sd">      pipeline_id: The string ID of a pipeline.</span>
<span class="sd">      version_id: The string ID of a pipeline version. </span>
<span class="sd">        If both pipeline_id and version_id are specified, pipeline_id will take precendence</span>
<span class="sd">        This will change in a future version, so it is recommended to use version_id by itself.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A JobConfig object with attributes spec and resource_reference.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">class</span> <span class="nc">JobConfig</span><span class="p">:</span>
      <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">resource_references</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="n">spec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource_references</span> <span class="o">=</span> <span class="n">resource_references</span>

    <span class="n">pipeline_json_string</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">pipeline_package_path</span><span class="p">:</span>
      <span class="n">pipeline_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_pipeline_yaml</span><span class="p">(</span><span class="n">pipeline_package_path</span><span class="p">)</span>
      <span class="n">pipeline_json_string</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">pipeline_obj</span><span class="p">)</span>
    <span class="n">api_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">kfp_server_api</span><span class="o">.</span><span class="n">ApiParameter</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">sanitize_k8s_name</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">allow_capital_underscore</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">value</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="n">resource_references</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ApiResourceKey</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">experiment_id</span><span class="p">,</span>
                                        <span class="nb">type</span><span class="o">=</span><span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ApiResourceType</span><span class="o">.</span><span class="n">EXPERIMENT</span><span class="p">)</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ApiResourceReference</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
                                                           <span class="n">relationship</span><span class="o">=</span><span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ApiRelationship</span><span class="o">.</span><span class="n">OWNER</span><span class="p">)</span>
    <span class="n">resource_references</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">version_id</span><span class="p">:</span>
      <span class="n">key</span> <span class="o">=</span> <span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ApiResourceKey</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">version_id</span><span class="p">,</span>
                                                 <span class="nb">type</span><span class="o">=</span><span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ApiResourceType</span><span class="o">.</span><span class="n">PIPELINE_VERSION</span><span class="p">)</span>
      <span class="n">reference</span> <span class="o">=</span> <span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ApiResourceReference</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
                                                             <span class="n">relationship</span><span class="o">=</span><span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ApiRelationship</span><span class="o">.</span><span class="n">CREATOR</span><span class="p">)</span>
      <span class="n">resource_references</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span>

    <span class="n">spec</span> <span class="o">=</span> <span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ApiPipelineSpec</span><span class="p">(</span>
        <span class="n">pipeline_id</span><span class="o">=</span><span class="n">pipeline_id</span><span class="p">,</span>
        <span class="n">workflow_manifest</span><span class="o">=</span><span class="n">pipeline_json_string</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="n">api_params</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">JobConfig</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span> <span class="n">resource_references</span><span class="o">=</span><span class="n">resource_references</span><span class="p">)</span>

<div class="viewcode-block" id="Client.create_run_from_pipeline_func"><a class="viewcode-back" href="../../source/kfp.client.html#kfp.Client.create_run_from_pipeline_func">[docs]</a>  <span class="k">def</span> <span class="nf">create_run_from_pipeline_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipeline_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">run_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">experiment_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pipeline_conf</span><span class="p">:</span> <span class="n">kfp</span><span class="o">.</span><span class="n">dsl</span><span class="o">.</span><span class="n">PipelineConf</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Runs pipeline on KFP-enabled Kubernetes cluster.</span>
<span class="sd">    This command compiles the pipeline function, creates or gets an experiment and submits the pipeline for execution.</span>

<span class="sd">    Args:</span>
<span class="sd">      pipeline_func: A function that describes a pipeline by calling components and composing them into execution graph.</span>
<span class="sd">      arguments: Arguments to the pipeline function provided as a dict.</span>
<span class="sd">      run_name: Optional. Name of the run to be shown in the UI.</span>
<span class="sd">      experiment_name: Optional. Name of the experiment to add the run to.</span>
<span class="sd">      namespace: kubernetes namespace where the pipeline runs are created.</span>
<span class="sd">        For single user deployment, leave it as None;</span>
<span class="sd">        For multi user, input a namespace where the user is authorized</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#TODO: Check arguments against the pipeline function</span>
    <span class="n">pipeline_name</span> <span class="o">=</span> <span class="n">pipeline_func</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="n">run_name</span> <span class="o">=</span> <span class="n">run_name</span> <span class="ow">or</span> <span class="n">pipeline_name</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H-%M-%S&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">pipeline_package_path</span><span class="p">)</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.zip&#39;</span><span class="p">)</span>
      <span class="n">compiler</span><span class="o">.</span><span class="n">Compiler</span><span class="p">()</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pipeline_func</span><span class="p">,</span> <span class="n">pipeline_package_path</span><span class="p">,</span> <span class="n">pipeline_conf</span><span class="o">=</span><span class="n">pipeline_conf</span><span class="p">)</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_run_from_pipeline_package</span><span class="p">(</span><span class="n">pipeline_package_path</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">run_name</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
      <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pipeline_package_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.create_run_from_pipeline_package"><a class="viewcode-back" href="../../source/kfp.client.html#kfp.Client.create_run_from_pipeline_package">[docs]</a>  <span class="k">def</span> <span class="nf">create_run_from_pipeline_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipeline_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">run_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">experiment_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Runs pipeline on KFP-enabled Kubernetes cluster.</span>
<span class="sd">    This command compiles the pipeline function, creates or gets an experiment and submits the pipeline for execution.</span>

<span class="sd">    Args:</span>
<span class="sd">      pipeline_file: A compiled pipeline package file.</span>
<span class="sd">      arguments: Arguments to the pipeline function provided as a dict.</span>
<span class="sd">      run_name: Optional. Name of the run to be shown in the UI.</span>
<span class="sd">      experiment_name: Optional. Name of the experiment to add the run to.</span>
<span class="sd">      namespace: kubernetes namespace where the pipeline runs are created.</span>
<span class="sd">        For single user deployment, leave it as None;</span>
<span class="sd">        For multi user, input a namespace where the user is authorized</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">class</span> <span class="nc">RunPipelineResult</span><span class="p">:</span>
      <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">run_info</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="o">=</span> <span class="n">client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_info</span> <span class="o">=</span> <span class="n">run_info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_id</span> <span class="o">=</span> <span class="n">run_info</span><span class="o">.</span><span class="n">id</span>

      <span class="k">def</span> <span class="nf">wait_for_run_completion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span> <span class="ow">or</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">max</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">min</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">wait_for_run_completion</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>

      <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;RunPipelineResult(run_id=</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_id</span><span class="p">)</span>

    <span class="c1">#TODO: Check arguments against the pipeline function</span>
    <span class="n">pipeline_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">pipeline_file</span><span class="p">)</span>
    <span class="n">experiment_name</span> <span class="o">=</span> <span class="n">experiment_name</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">KF_PIPELINES_DEFAULT_EXPERIMENT_NAME</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">overridden_experiment_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">KF_PIPELINES_OVERRIDE_EXPERIMENT_NAME</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">overridden_experiment_name</span> <span class="o">!=</span> <span class="n">experiment_name</span><span class="p">:</span>
      <span class="kn">import</span> <span class="nn">warnings</span>
      <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Changing experiment name from &quot;</span><span class="si">{}</span><span class="s1">&quot; to &quot;</span><span class="si">{}</span><span class="s1">&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">,</span> <span class="n">overridden_experiment_name</span><span class="p">))</span>
    <span class="n">experiment_name</span> <span class="o">=</span> <span class="n">overridden_experiment_name</span> <span class="ow">or</span> <span class="s1">&#39;Default&#39;</span>
    <span class="n">run_name</span> <span class="o">=</span> <span class="n">run_name</span> <span class="ow">or</span> <span class="n">pipeline_name</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H-%M-%S&#39;</span><span class="p">)</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_experiment</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">experiment_name</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">)</span>
    <span class="n">run_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_pipeline</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">run_name</span><span class="p">,</span> <span class="n">pipeline_file</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">RunPipelineResult</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_info</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.list_runs"><a class="viewcode-back" href="../../source/kfp.client.html#kfp.Client.list_runs">[docs]</a>  <span class="k">def</span> <span class="nf">list_runs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page_token</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">experiment_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;List runs.</span>
<span class="sd">    Args:</span>
<span class="sd">      page_token: token for starting of the page.</span>
<span class="sd">      page_size: size of the page.</span>
<span class="sd">      sort_by: one of &#39;field_name&#39;, &#39;field_name des&#39;. For example, &#39;name des&#39;.</span>
<span class="sd">      experiment_id: experiment id to filter upon</span>
<span class="sd">      namespace: kubernetes namespace to filter upon.</span>
<span class="sd">        For single user deployment, leave it as None;</span>
<span class="sd">        For multi user, input a namespace where the user is authorized.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A response object including a list of experiments and next page token.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">namespace</span> <span class="o">=</span> <span class="n">namespace</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_namespace</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">experiment_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_api</span><span class="o">.</span><span class="n">list_runs</span><span class="p">(</span><span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="n">sort_by</span><span class="p">,</span> <span class="n">resource_reference_key_type</span><span class="o">=</span><span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">api_resource_type</span><span class="o">.</span><span class="n">ApiResourceType</span><span class="o">.</span><span class="n">EXPERIMENT</span><span class="p">,</span> <span class="n">resource_reference_key_id</span><span class="o">=</span><span class="n">experiment_id</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">namespace</span><span class="p">:</span>
      <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_api</span><span class="o">.</span><span class="n">list_runs</span><span class="p">(</span><span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="n">sort_by</span><span class="p">,</span> <span class="n">resource_reference_key_type</span><span class="o">=</span><span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">api_resource_type</span><span class="o">.</span><span class="n">ApiResourceType</span><span class="o">.</span><span class="n">NAMESPACE</span><span class="p">,</span> <span class="n">resource_reference_key_id</span><span class="o">=</span><span class="n">namespace</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_api</span><span class="o">.</span><span class="n">list_runs</span><span class="p">(</span><span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="n">sort_by</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span></div>

<div class="viewcode-block" id="Client.list_recurring_runs"><a class="viewcode-back" href="../../source/kfp.client.html#kfp.Client.list_recurring_runs">[docs]</a>  <span class="k">def</span> <span class="nf">list_recurring_runs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page_token</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">experiment_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;List recurring runs.</span>
<span class="sd">    Args:</span>
<span class="sd">      page_token: token for starting of the page.</span>
<span class="sd">      page_size: size of the page.</span>
<span class="sd">      sort_by: one of &#39;field_name&#39;, &#39;field_name des&#39;. For example, &#39;name des&#39;.</span>
<span class="sd">      experiment_id: experiment id to filter upon</span>
<span class="sd">    Returns:</span>
<span class="sd">      A response object including a list of recurring_runs and next page token.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">experiment_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_api</span><span class="o">.</span><span class="n">list_jobs</span><span class="p">(</span><span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="n">sort_by</span><span class="p">,</span> <span class="n">resource_reference_key_type</span><span class="o">=</span><span class="n">kfp_server_api</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">api_resource_type</span><span class="o">.</span><span class="n">ApiResourceType</span><span class="o">.</span><span class="n">EXPERIMENT</span><span class="p">,</span> <span class="n">resource_reference_key_id</span><span class="o">=</span><span class="n">experiment_id</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_api</span><span class="o">.</span><span class="n">list_jobs</span><span class="p">(</span><span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="n">sort_by</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span></div>

<div class="viewcode-block" id="Client.get_recurring_run"><a class="viewcode-back" href="../../source/kfp.client.html#kfp.Client.get_recurring_run">[docs]</a>  <span class="k">def</span> <span class="nf">get_recurring_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get recurring_run details.</span>
<span class="sd">    Args:</span>
<span class="sd">      id of the recurring_run.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A response object including details of a recurring_run.</span>
<span class="sd">    Throws:</span>
<span class="sd">      Exception if recurring_run is not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_api</span><span class="o">.</span><span class="n">get_job</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">job_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="Client.get_run"><a class="viewcode-back" href="../../source/kfp.client.html#kfp.Client.get_run">[docs]</a>  <span class="k">def</span> <span class="nf">get_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get run details.</span>
<span class="sd">    Args:</span>
<span class="sd">      id of the run.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A response object including details of a run.</span>
<span class="sd">    Throws:</span>
<span class="sd">      Exception if run is not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_api</span><span class="o">.</span><span class="n">get_run</span><span class="p">(</span><span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.wait_for_run_completion"><a class="viewcode-back" href="../../source/kfp.client.html#kfp.Client.wait_for_run_completion">[docs]</a>  <span class="k">def</span> <span class="nf">wait_for_run_completion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">timeout</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wait for a run to complete.</span>
<span class="sd">    Args:</span>
<span class="sd">      run_id: run id, returned from run_pipeline.</span>
<span class="sd">      timeout: timeout in seconds.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A run detail object: Most important fields are run and pipeline_runtime</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;Running:&#39;</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="k">while</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;succeeded&#39;</span><span class="p">,</span> <span class="s1">&#39;failed&#39;</span><span class="p">,</span> <span class="s1">&#39;skipped&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">]:</span>
      <span class="n">get_run_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_api</span><span class="o">.</span><span class="n">get_run</span><span class="p">(</span><span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span>
      <span class="n">status</span> <span class="o">=</span> <span class="n">get_run_response</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">status</span>
      <span class="n">elapsed_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Waiting for the job to complete...&#39;</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">elapsed_time</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TimeoutError</span><span class="p">(</span><span class="s1">&#39;Run timeout&#39;</span><span class="p">)</span>
      <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">get_run_response</span></div>

  <span class="k">def</span> <span class="nf">_get_workflow_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the workflow json.</span>
<span class="sd">    Args:</span>
<span class="sd">      run_id: run id, returned from run_pipeline.</span>
<span class="sd">    Returns:</span>
<span class="sd">      workflow: json workflow</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">get_run_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_api</span><span class="o">.</span><span class="n">get_run</span><span class="p">(</span><span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">)</span>
    <span class="n">workflow</span> <span class="o">=</span> <span class="n">get_run_response</span><span class="o">.</span><span class="n">pipeline_runtime</span><span class="o">.</span><span class="n">workflow_manifest</span>
    <span class="n">workflow_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">workflow</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">workflow_json</span>

<div class="viewcode-block" id="Client.upload_pipeline"><a class="viewcode-back" href="../../source/kfp.client.html#kfp.Client.upload_pipeline">[docs]</a>  <span class="k">def</span> <span class="nf">upload_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipeline_package_path</span><span class="p">,</span> <span class="n">pipeline_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Uploads the pipeline to the Kubeflow Pipelines cluster.</span>
<span class="sd">    Args:</span>
<span class="sd">      pipeline_package_path: Local path to the pipeline package.</span>
<span class="sd">      pipeline_name: Optional. Name of the pipeline to be shown in the UI.</span>
<span class="sd">    Returns:</span>
<span class="sd">      Server response object containing pipleine id and other information.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_api</span><span class="o">.</span><span class="n">upload_pipeline</span><span class="p">(</span><span class="n">pipeline_package_path</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">pipeline_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_ipython</span><span class="p">():</span>
      <span class="kn">import</span> <span class="nn">IPython</span>
      <span class="n">html</span> <span class="o">=</span> <span class="s1">&#39;Pipeline link &lt;a href=</span><span class="si">%s</span><span class="s1">/#/pipelines/details/</span><span class="si">%s</span><span class="s1">&gt;here&lt;/a&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_url_prefix</span><span class="p">(),</span> <span class="n">response</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
      <span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">response</span></div>

<div class="viewcode-block" id="Client.get_pipeline"><a class="viewcode-back" href="../../source/kfp.client.html#kfp.Client.get_pipeline">[docs]</a>  <span class="k">def</span> <span class="nf">get_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipeline_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get pipeline details.</span>
<span class="sd">    Args:</span>
<span class="sd">      id of the pipeline.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A response object including details of a pipeline.</span>
<span class="sd">    Throws:</span>
<span class="sd">      Exception if pipeline is not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipelines_api</span><span class="o">.</span><span class="n">get_pipeline</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pipeline_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.delete_pipeline"><a class="viewcode-back" href="../../source/kfp.client.html#kfp.Client.delete_pipeline">[docs]</a>  <span class="k">def</span> <span class="nf">delete_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipeline_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Delete pipeline.</span>
<span class="sd">    Args:</span>
<span class="sd">      id of the pipeline.</span>
<span class="sd">    Returns:</span>
<span class="sd">      Object. If the method is called asynchronously,</span>
<span class="sd">      returns the request thread.</span>
<span class="sd">    Throws:</span>
<span class="sd">      Exception if pipeline is not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipelines_api</span><span class="o">.</span><span class="n">delete_pipeline</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pipeline_id</span><span class="p">)</span></div></div>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">types</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="sd">kfp.fullClient class</span>
<span class="sd">--------------------</span>

<span class="sd">.. autoclass:: kfp.fullClient</span>
<span class="sd">  :members:</span>
<span class="sd">  :undoc-members:</span>
<span class="sd">  :show-inheritance:</span>

<span class="sd">.. automethod:: kfp.fullClient.jobs.create_job</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;BUILD_KFP_DOCS&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>

  <span class="n">instance_client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="s1">&#39;7ac913b884ad9e6c-dot-us-central2.pipelines.googleusercontent.com&#39;</span><span class="p">)</span>

  <span class="n">need_to_add</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">instance_client</span><span class="p">))</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">Client</span><span class="p">)))</span>
  <span class="n">need_to_add</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

  <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">need_to_add</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
      <span class="nb">print</span><span class="p">()</span>
      <span class="n">sub_heading</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;kfp.Client.</span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2"> Struct&quot;</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">sub_heading</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sub_heading</span><span class="p">))</span>
      <span class="nb">print</span><span class="p">()</span>
      <span class="n">methods</span> <span class="o">=</span> <span class="nb">dir</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">instance_client</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>
      <span class="n">methods</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
      <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
          <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  .. automethod:: kfp.Client.</span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

  <span class="n">instance_client_dict</span> <span class="o">=</span> <span class="n">instance_client</span><span class="o">.</span><span class="vm">__dict__</span>
  <span class="n">smart_client_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Client</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

  <span class="n">smart_client_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">instance_client_dict</span><span class="p">)</span>

  <span class="n">Client</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;Client&#39;</span><span class="p">,</span> <span class="n">Client</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">,</span> <span class="n">smart_client_dict</span><span class="p">)</span>

  <span class="c1"># # .. automethod:: kfp.fullClient.jobs.create_job</span>

  <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  breakpoint()</span>
<span class="sd">  </span>
<span class="sd">  class fullClient(Client):</span>
<span class="sd">    pass</span>

<span class="sd">  for attr in need_to_add:</span>
<span class="sd">    func = getattr(instance_client, attr)</span>
<span class="sd">    if callable(func):</span>
<span class="sd">      method = types.MethodType(func, fullClient)</span>
<span class="sd">      setattr(fullClient, attr, method)</span>
<span class="sd">      print(f&quot;Added {attr}&quot;)</span>
<span class="sd">    else:</span>
<span class="sd">      print(f&quot;Couldn&#39;t append {attr}&quot;)&quot;&quot;&quot;</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Google

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>